<dom-module id="spark-controller">

  <template>

  <iron-ajax
    id="access_token_request"
    url="https://api.particle.io/oauth/token"
    handle-as="json"
    method="POST">
  </iron-ajax>


  <iron-ajax
    id="device_list_request"
    url="https://api.particle.io/v1/devices"
    handle-as="json"
    method="GET">
  </iron-ajax>


  <iron-ajax
    id="function_request"
    url=""
    handle-as="json"
    method="POST">
  </iron-ajax>

  </template>

  <script>
    (function() {
      Polymer({
        is: 'spark-controller',

        propreties : {
          username : {
            type: String
          },

          password : {
            type: String
          },
        },

        getAccessToken : function(e){
          var access_token_request  = this.$.access_token_request;
          access_token_request.headers = {Authorization : "Basic cGFydGljbGU6cGFydGljbGU="};
          access_token_request.body =
          "grant_type=password"
           + "&username=" + encodeURIComponent(e.username)
           + "&password=" + encodeURIComponent(e.password);
          access_token_request.generateRequest();
        },

        getDevices : function(accessToken){
          var device_list_request = this.$.device_list_request;
          device_list_request.params = { "access_token" : encodeURIComponent(accessToken)};
          device_list_request.generateRequest();
        },

        executeFunction : function(accessToken, deviceId, args){
          var function_request = this.$.function_request;
          function_request.url = "https://api.particle.io/v1/devices/" + deviceId + "/sendIR";
          function_request.body =
          "access_token=" + encodeURIComponent(accessToken)
          + "&args=" + args;
          function_request.generateRequest();
        }

      });
      })();
  </script>

</dom-module>
